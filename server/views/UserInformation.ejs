<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Profile</title>
    <script src="/js/jquery.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <style>
        .dropdown:hover .dropdown-menu {
            display: block;
            margin-top: 0;
        }
    </style>
</head>

<body style="background-color: #f0e9d3">
    <% include fragment/header %>
    <div class="divtotal" style="background-color: #fff">
        <div class="container">
            <div class="row my-2">
                <div class="col-lg-8 order-lg-2">
                    <ul class="nav nav-tabs">
                        <li class="nav-item tab">
                            <a href="" data-target="#profile" data-toggle="tab" class="nav-link active"
                                style="color: #343a40; background-color:#fff">Hồ sơ cá nhân</a>
                        </li>
                        <li class="nav-item tab">
                            <a href="" data-target="#messages" data-toggle="tab" class="nav-link"
                                style="color: #343a40">Thông báo</a>
                        </li>
                        <li class="nav-item tab">
                            <a href="" data-target="#edit" data-toggle="tab" class="nav-link"
                                style="color: #343a40">Chỉnh sửa thông tin</a>
                        </li>
                    </ul>
                    <div class="tab-content py-4">
                        <div class="tab-pane active" id="profile">
                            <h5 class="mb-3"><%= user.username %></h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Vai trò</h6>
                                    <p>
                                        <%= user.role %>
                                    </p>
                                    <h6>Email</h6>
                                    <p>
                                        <%= user.email %>
                                    </p>
                                    <h6>Ngày sinh</h6>
                                    <p>
                                        <%= user.birthday %>
                                    </p>
                                </div>
                                <div class="col-md-6">
                                    <h6>Chuyên mục quan tâm</h6>
                                    <% user.favCat.forEach(function (category) { %>
                                    <a href="<%= category.url %>"
                                        class="badge badge-dark badge-pill"><%= category.name %></a>
                                    <% }); %>
                                    <hr>
                                    <span class="badge badge-primary"><i class="fas fa-thumbs-up"></i> <%= user.likes %>
                                        Likes</span>
                                    <span class="badge badge-success"><i class="fas fa-comments"></i>
                                        <%= user.comments %> Comments</span>
                                    <span class="badge badge-danger"><i class="fas fa-share-alt-square"></i>
                                        <%= user.shares %>
                                        Shares</span>
                                </div>
                                <div class="col-md-12">
                                    <h5 class="mt-2"><span class="fa fa-clock-o ion-clock float-right"></span>Hoạt động
                                        gần đây</h5>
                                    <table class="table table-sm table-hover table-striped">
                                        <tbody>
                                            <% user.activities.forEach(function (activity) { %>
                                            <tr>
                                                <td>
                                                    <strong>Bạn</strong> <%= activity.action %> <a href="<%= activity.link %>"
                                                        class="post-title"><%= activity.post %></a>
                                                </td>
                                            </tr>
                                            <% }) %>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!--/row-->
                        </div>
                        <div class="tab-pane" id="messages">
                            <% user.notifications.forEach(function (notify) { if (notify.alert) {%>
                            <div class="alert <%= notify.alert%> alert-dismissable">
                                <a class="panel-close close" data-dismiss="alert">×</a><%= notify.msg %>
                            </div>
                            <% }}); %>
                            <table class="table table-hover table-striped">
                                <tbody>
                                    <% user.notifications.forEach(function (notify) { if (!notify.alert) {%>
                                    <tr>
                                        <td>
                                            <span class="float-right font-weight-bold">3 giờ trước</span><%= notify.msg %> 
                                        </td>
                                    </tr>
                                    <% }}); %>
                                </tbody>
                            </table>
                        </div>
                        <div class="tab-pane" id="edit">
                            <form id="updateForm" role="form" action="updateinfo" method="POST">
                                    <% if (msg) { %>
                                    <div class="alert <%= msg.type %> alert-dismissible" id="alert_success">
                                        <button type="button" class="close" data-dismiss="alert">&times;</button>
                                        <strong><i class="fas fa-check"></i><%= msg.msg %></strong>
                                    </div>
                                    <% } %>
                                <div class="form-group row">
                                    <label class="col-lg-3 col-form-label form-control-label">Họ và Tên</label>
                                    <div class="col-lg-9">
                                        <input name="username" class="form-control" type="text" value="<%= user.username %>">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-lg-3 col-form-label form-control-label">Email</label>
                                    <div class="col-lg-9">
                                        <input name="email" class="form-control" type="email" value="<%= user.email %>">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-lg-3 col-form-label form-control-label">Ngày sinh</label>
                                    <div class="col-lg-9">
                                        <input name="birthday" class="form-control" type="date" value="<%= user.birthday %>">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-lg-3 col-form-label form-control-label">Địa chỉ</label>
                                    <div class="col-lg-9">
                                        <input name="address_street" class="form-control" type="text" value="<%= user.address.street %>" placeholder="Đường">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-lg-3 col-form-label form-control-label"></label>
                                    <div class="col-lg-3">
                                        <input name="address_ward" class="form-control" type="text" value="<%= user.address.ward %>" placeholder="Phường">
                                    </div>
                                    <div class="col-lg-3">
                                        <input name="address_district" class="form-control" type="text" value="<%= user.address.district %>" placeholder="Quận">
                                    </div>
                                    <div class="col-lg-3">
                                        <input name="address_city" class="form-control" type="text" value="<%= user.address.city %>" placeholder="Thành phố">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-lg-3 col-form-label form-control-label"></label>
                                    <div class="col-lg-9">
                                        <input type="reset" class="btn btn-secondary" value="Cancel">
                                        <input type="submit" class="btn btn-primary" value="Save Changes">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 order-lg-1 text-center">
                    <img id="avatarPreview" src="<%= user.avatar %>" class="mx-auto img-fluid img-circle d-block" alt="avatar"
                        style="width:180px; margin-bottom:20px">
                    <h6 class="mt-2">Upload a different photo</h6>
                    <label class="custom-file">
                        <input id="inputAvatar" type="file" id="file" aria-label="File browser" accept=".jpg, .jpeg, .png">
                        <span class="file-custom"></span>
                    </label>
                </div>
            </div>
        </div>
    </div>
    <% include fragment/footer %>
    <script src="/js/popper.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <!-- <script src="js/script.js"></script> -->
    <script>
            $(document).ready(function(){
              $("#updateForm").on('input', function() {
                password.setCustomValidity(password.value != confirmpassword.value ? "Mật khẩu không khớp." : "");
              })
              $("#inputPassword").tooltip({'trigger':'focus', 'title': 'Mật khẩu phải chứa chữ, số và tối thiểu 6 ký tự'});

              $("#inputAvatar").change(function (){
                var curFiles = this.files;
                console.log(curFiles);
                
                var fd = new FormData();
                fd.append("image", curFiles[0])
                $.ajax({
                    url: '/user/updateavatar',
                    type: 'POST',
                    data: fd,
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        if (response != 0) {
                            $("#avatarPreview").attr("src", window.URL.createObjectURL(curFiles[0]));
                        } else {
                            alert('file not uploaded');
                        }
                    },
                });
              });
            });
          </script>
</body>

</html>